<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvoiceFlow - Logo Persistence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { darkBg: '#0f172a' } } } }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@200;400;600;800&display=swap');
        body { font-family: 'Assistant', sans-serif; transition: all 0.3s; }
        .glass { backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .dark .glass { background: rgba(30, 41, 59, 0.7); }
        .light .glass { background: rgba(255, 255, 255, 0.9); border: 1px solid rgba(0,0,0,0.1); }
        .page-section { display: none; }
        .page-section.active { display: block; }
        .preview-paper { width: 210mm; min-height: 297mm; padding: 20mm; background: white; color: #1e293b; margin: auto; box-shadow: 0 0 20px rgba(0,0,0,0.2); position: relative; }
        #logoPreview { max-height: 80px; max-width: 200px; object-fit: contain; }
    </style>
</head>
<body class="dark bg-darkBg text-slate-200 h-screen flex overflow-hidden" id="bodyTag">

    <aside class="w-64 bg-slate-950/50 border-l border-white/5 flex flex-col p-6 no-print">
        <div class="flex items-center gap-3 mb-10">
            <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg"><i class="fas fa-bolt text-white"></i></div>
            <span class="text-xl font-extrabold italic">Invoice<span class="text-blue-500">Flow</span></span>
        </div>
        <nav class="space-y-1 flex-1">
            <button onclick="navigateTo('dashboard')" class="nav-btn w-full flex items-center p-3 rounded-xl bg-blue-600 text-white font-bold transition"><i class="fas fa-chart-pie ml-3"></i> דשבורד</button>
            <button onclick="navigateTo('createDoc')" class="nav-btn w-full flex items-center p-3 rounded-xl text-slate-400 hover:text-white transition"><i class="fas fa-plus-circle ml-3"></i> יצירת מסמך</button>
            <button onclick="navigateTo('settings')" class="nav-btn w-full flex items-center p-3 rounded-xl text-slate-400 hover:text-white transition"><i class="fas fa-cog ml-3"></i> הגדרות עסק</button>
        </nav>
        <button onclick="toggleTheme()" class="p-3 rounded-xl bg-slate-800 text-xs font-bold flex items-center justify-center gap-2">
            <i class="fas fa-moon" id="themeIcon"></i> <span id="themeText">מצב בהיר</span>
        </button>
    </aside>

    <main class="flex-1 flex flex-col overflow-hidden">
        <header class="h-20 flex items-center justify-between px-10 border-b border-white/5 glass no-print">
            <h2 id="pageTitle" class="text-xl font-black">דשבורד</h2>
        </header>

        <div class="flex-1 overflow-y-auto p-8">
            
            <section id="settings" class="page-section">
                <div class="glass p-8 rounded-[2.5rem] space-y-8">
                    <h3 class="text-xl font-bold italic">הגדרות פרופיל עסק</h3>
                    
                    <div class="flex items-center gap-6">
                        <div id="logoDropZone" class="w-32 h-32 bg-slate-900 border-2 border-dashed border-slate-700 rounded-3xl flex flex-col items-center justify-center cursor-pointer hover:border-blue-500 transition overflow-hidden">
                            <img id="logoImgContainer" class="hidden w-full h-full object-contain" />
                            <div id="logoUploadPlaceholder" class="flex flex-col items-center">
                                <i class="fas fa-image text-2xl text-slate-600"></i>
                                <span class="text-[10px] text-slate-500 mt-2 font-bold">העלה לוגו</span>
                            </div>
                        </div>
                        <input type="file" id="logoInput" class="hidden" accept="image/*">
                        <div>
                            <p class="text-sm font-bold">לוגו העסק</p>
                            <p class="text-[10px] text-slate-500">הקובץ יישמר אוטומטית בדפדפן</p>
                            <button onclick="document.getElementById('logoInput').click()" class="mt-2 text-xs text-blue-500 underline font-bold">בחר קובץ</button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <input type="text" id="myBusName" placeholder="שם העסק שלך" class="save-input bg-slate-900 p-4 rounded-xl border border-white/5 outline-none">
                        <input type="text" id="myBusId" placeholder="ח.פ / עוסק מורשה" class="save-input bg-slate-900 p-4 rounded-xl border border-white/5 outline-none">
                    </div>
                </div>
            </section>

            <section id="createDoc" class="page-section">
                <div class="glass p-8 rounded-[2.5rem] space-y-6">
                    <input type="text" id="custName" placeholder="שם הלקוח" class="save-input bg-slate-900 p-4 rounded-xl border border-white/5 outline-none w-full">
                    <button onclick="updatePreview(); navigateTo('preview')" class="w-full bg-blue-600 py-4 rounded-xl font-bold">צפה והפק מסמך</button>
                </div>
            </section>

            <section id="preview" class="page-section no-print">
                <div class="preview-paper text-right">
                    <div class="flex justify-between items-start mb-16">
                        <div>
                            <img id="previewLogo" src="" class="hidden mb-4 max-h-20" />
                            <h1 id="preMyBusName" class="text-2xl font-black text-blue-600 leading-none">שם העסק שלך</h1>
                            <p id="preMyBusId" class="text-xs text-slate-400 mt-1">ח.פ 00000000</p>
                        </div>
                        <div class="text-4xl font-black opacity-10">INVOICE</div>
                    </div>
                    
                    <div class="border-r-4 border-blue-600 pr-4 mb-10">
                        <p class="text-[10px] text-slate-400 font-bold">עבור:</p>
                        <h4 id="preCustName" class="text-lg font-bold">שם הלקוח</h4>
                    </div>

                    <div class="mt-20 border-t pt-10 text-center">
                        <p class="text-xs text-slate-400">תודה על בחירתכם בנו!</p>
                    </div>
                    
                    <div class="no-print mt-10 flex gap-4">
                        <button onclick="window.print()" class="bg-slate-900 text-white px-8 py-3 rounded-xl font-bold">הדפס / PDF</button>
                        <button onclick="navigateTo('createDoc')" class="bg-slate-100 text-slate-800 px-8 py-3 rounded-xl font-bold">חזור לעריכה</button>
                    </div>
                </div>
            </section>

            <section id="dashboard" class="page-section active">
                <div class="glass p-10 rounded-[2rem] text-center">
                    <h3 class="text-2xl font-bold mb-2 italic">שלום, מוכן להפיק מסמך?</h3>
                </div>
            </section>

        </div>
    </main>

    <script>
        // ניווט
        function navigateTo(id) {
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('pageTitle').innerText = (id === 'settings') ? 'הגדרות' : (id === 'createDoc' ? 'יצירה' : 'דשבורד');
        }

        // לוגיקת לוגו (Base64 + LocalStorage)
        const logoInput = document.getElementById('logoInput');
        const logoImgContainer = document.getElementById('logoImgContainer');
        const logoPlaceholder = document.getElementById('logoUploadPlaceholder');
        const previewLogo = document.getElementById('previewLogo');

        logoInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64Image = e.target.result;
                    localStorage.setItem('savedLogo', base64Image);
                    loadLogo(base64Image);
                };
                reader.readAsDataURL(file);
            }
        });

        function loadLogo(data) {
            if (data) {
                logoImgContainer.src = data;
                logoImgContainer.classList.remove('hidden');
                logoPlaceholder.classList.add('hidden');
                previewLogo.src = data;
                previewLogo.classList.remove('hidden');
            }
        }

        // טעינת נתונים ראשונית
        window.onload = () => {
            // טעינת טקסטים
            document.querySelectorAll('.save-input').forEach(input => {
                const savedValue = localStorage.getItem(input.id);
                if (savedValue) input.value = savedValue;
            });
            // טעינת לוגו
            const savedLogo = localStorage.getItem('savedLogo');
            if (savedLogo) loadLogo(savedLogo);
        };

        // שמירת טקסט בכל הקלדה
        document.querySelectorAll('.save-input').forEach(input => {
            input.addEventListener('input', () => {
                localStorage.setItem(input.id, input.value);
            });
        });

        function updatePreview() {
            document.getElementById('preMyBusName').innerText = document.getElementById('myBusName').value || "שם העסק שלך";
            document.getElementById('preMyBusId').innerText = "ח.פ " + (document.getElementById('myBusId').value || "00000000");
            document.getElementById('preCustName').innerText = document.getElementById('custName').value || "שם הלקוח";
        }

        function toggleTheme() {
            const body = document.getElementById('bodyTag');
            body.classList.toggle('dark');
        }
    </script>
</body>
</html>
